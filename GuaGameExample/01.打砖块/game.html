<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>game 1</title>
		<style media="screen">
			canvas {
				border: 1px black solid;
			}
		</style>
		<script src="utils.js"></script>
		<script src="guagame.js"></script>
		<script src="ball.js"></script>
		<script src="paddle.js"></script>
		<script src="block.js"></script>
	</head>
	<body>
		<canvas id="id-canvas" width="400" height="300"></canvas>
		<script>		
			var __main = function() {
				var game = GuaGame(40)
				
				//var paddle = Paddle()
				paddle = Paddle()
				var ball = Ball()
				var block = Block()
				
				var blocks = []
				for (var i = 0; i < 4; i++) {
					var b = Block()
					b.x = i * 150
					b.y = 50
					blocks.push(b)
					if (i == 3) {
						b.x = 100
						b.y = 200
					}
				}
				var paused = false
				game.registerAction('a', function() {
					paddle.moveLeft()
				})

				game.registerAction('d', function() {
					paddle.moveRight()
				})				
				game.registerAction('f', function() {
					ball.fire()
				})		
				window.addEventListener('keydown', function(event){
					if (event.key == 'p') {
						paused = !paused
					}
				})
				game.update = function() {
					if (paused) {
						return
					}
					ball.move()
					// 判断相撞
					if (paddle.collide(ball)) {
						ball.反弹()
					}
					for (var i = 0; i < blocks.length; i++){
						var block = blocks[i]
						if (block.collide(ball)) {
							block.kill()
							ball.反弹()
						}
					}					
				}

				game.draw = function() {
					// draw 
					game.drawImage(paddle)
					game.drawImage(ball)

					// 判断　ball 和　blocks 相撞
					for (var i = 0; i < blocks.length; i++){
						var block = blocks[i]
						if (block.alive) {
							game.drawImage(block)
						}
					}
				}
			}
		
			__main()
		</script>
	</body>
</html>
